<div class="container animate-fade">
    <div class="page-title-section">
        <div>
            <h1 class="title-font">Nova Reserva</h1>
            <p>Selecione o leitor e a obra para realizar o empréstimo.</p>
        </div>
        <a routerLink="/reservas" class="btn-premium btn-premium-secondary">
            <lucide-icon [img]="ArrowLeftIcon" [size]="18"></lucide-icon>
            Voltar
        </a>
    </div>

    <div class="card-premium">
        <div *ngIf="loading" class="loading-state">Carregando dados...</div>

        <form *ngIf="!loading" [formGroup]="form" (ngSubmit)="onSubmit()" class="form-premium">
            <div class="form-section">
                <h3 class="section-title">Dados do Empréstimo</h3>

                <div class="form-group mb-6">
                    <label for="clienteId">Cliente / Leitor</label>
                    <select id="clienteId" formControlName="clienteId" class="input-premium"
                        [class.error]="isFieldInvalid('clienteId')">
                        <option value="">Selecione um cliente...</option>
                        <option *ngFor="let cliente of clientes" [value]="cliente._id">{{ cliente.nome }} ({{
                            cliente.cpf }})</option>
                    </select>
                    <span class="error-msg" *ngIf="isFieldInvalid('clienteId')">{{ getFieldError('clienteId') }}</span>
                </div>

                <div class="form-group mb-6">
                    <label for="livroId">Livro (Somente Disponíveis)</label>
                    <select id="livroId" formControlName="livroId" class="input-premium"
                        [class.error]="isFieldInvalid('livroId')">
                        <option value="">Selecione um livro disponível...</option>
                        <option *ngFor="let livro of livrosDisponiveis" [value]="livro._id">{{ livro.titulo }} - {{
                            livro.autor }}</option>
                    </select>
                    <span class="error-msg" *ngIf="isFieldInvalid('livroId')">{{ getFieldError('livroId') }}</span>
                    <p *ngIf="livrosDisponiveis.length === 0" class="warning-text">Não há livros disponíveis no momento.
                    </p>
                </div>

                <div class="form-group">
                    <label for="dataPrevistaDevolucao">Data de Devolução Prevista</label>
                    <input type="date" id="dataPrevistaDevolucao" formControlName="dataPrevistaDevolucao"
                        class="input-premium" [min]="getMinDate()">
                    <span class="error-msg" *ngIf="isFieldInvalid('dataPrevistaDevolucao')">{{
                        getFieldError('dataPrevistaDevolucao') }}</span>
                </div>
            </div>

            <div class="form-actions-premium">
                <button type="button" routerLink="/reservas" class="btn-premium btn-premium-secondary">Cancelar</button>
                <button type="submit" class="btn-premium btn-premium-primary"
                    [disabled]="submitting || livrosDisponiveis.length === 0">
                    <lucide-icon *ngIf="!submitting" [img]="SaveIcon" [size]="18"></lucide-icon>
                    {{ submitting ? 'Confirmando...' : 'Confirmar Reserva' }}
                </button>
            </div>
        </form>
    </div>
</div>