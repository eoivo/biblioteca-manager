<div class="container animate-fade">
    <div class="page-title-section">
        <div>
            <h1 class="title-font">Nova Reserva</h1>
            <p>Selecione o leitor e a obra para realizar o empréstimo.</p>
        </div>
        <a routerLink="/reservas" class="btn-premium btn-premium-secondary">
            <lucide-icon [img]="ArrowLeftIcon" [size]="18"></lucide-icon>
            Voltar
        </a>
    </div>

    <div class="card-premium">
        <div *ngIf="loading" class="loading-state">Carregando dados...</div>

        <form *ngIf="!loading" [formGroup]="form" (ngSubmit)="onSubmit()" class="form-premium">
            <div class="form-section">
                <h3 class="section-title">Dados do Empréstimo</h3>

                <div class="form-group mb-6">
                    <label for="clienteId">Cliente / Leitor <span class="required-mark">*</span></label>
                    <app-custom-select formControlName="clienteId" [options]="clienteOptions"
                        placeholder="Selecione um cliente..." [searchable]="true"
                        [error]="isFieldInvalid('clienteId')"></app-custom-select>
                    <span class="error-msg" *ngIf="isFieldInvalid('clienteId')">{{ getFieldError('clienteId') }}</span>
                </div>

                <div class="form-group mb-6">
                    <label for="livroId">Livro (Somente Disponíveis) <span class="required-mark">*</span></label>
                    <app-custom-select formControlName="livroId" [options]="livroOptions"
                        placeholder="Selecione um livro disponível..." [searchable]="true"
                        [error]="isFieldInvalid('livroId')"></app-custom-select>
                    <span class="error-msg" *ngIf="isFieldInvalid('livroId')">{{ getFieldError('livroId') }}</span>
                    <p *ngIf="livroOptions.length === 0 && !loading" class="warning-text">Não há livros disponíveis no
                        momento.</p>
                </div>

                <div class="form-group">
                    <label for="dataPrevistaDevolucao">Data de Devolução Prevista <span
                            class="required-mark">*</span></label>
                    <app-calendar formControlName="dataPrevistaDevolucao" [minDate]="minDateValue"
                        placeholder="Selecione ou digite a data"></app-calendar>
                    <span class="error-msg" *ngIf="isFieldInvalid('dataPrevistaDevolucao')">{{
                        getFieldError('dataPrevistaDevolucao') }}</span>
                    <p class="hint-text mt-2">Identificamos o prazo automaticamente. Datas no passado serão alertadas
                        pelo sistema.</p>
                </div>
            </div>

            <div class="form-actions-premium">
                <button type="button" routerLink="/reservas" class="btn-premium btn-premium-secondary">Cancelar</button>
                <button type="submit" class="btn-premium btn-premium-primary"
                    [disabled]="submitting || livrosDisponiveis.length === 0">
                    <lucide-icon *ngIf="!submitting" [img]="SaveIcon" [size]="18"></lucide-icon>
                    {{ submitting ? 'Confirmando...' : 'Confirmar Reserva' }}
                </button>
            </div>
        </form>
    </div>
</div>